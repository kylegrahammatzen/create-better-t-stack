import { autumnHandler } from "autumn-js/next";
{{#if (eq auth "better-auth")}}
import { auth } from "@{{projectName}}/auth";
import { headers } from "next/headers";
{{/if}}

export const { GET, POST } = autumnHandler({
	identify: async () => {
{{#if (eq auth "better-auth")}}
		const session = await auth.api.getSession({
			headers: await headers(),
		});

		if (!session) return null;

		return {
			customerId: session.user.id,
			customerData: {
				name: session.user.name || "",
				email: session.user.email || "",
			},
		};
{{else}}
		// No auth configured - return default customer
		return {
			customerId: "better-t-stack",
			customerData: {
				name: "Better T Stack",
				email: "better-t-stack@example.com",
			},
		};
{{/if}}
	},
});
